<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>MyGameCollection</title>

    <!-- Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          rel="stylesheet">

    <link th:href="@{/css/style.css}" rel="stylesheet"/>

    <!-- Estilos del bot√≥n de acciones (3 puntos) -->
    <style>
        /* Para que el dropdown se coloque arriba a la derecha dentro de la caja */
        .col-item { position: relative; }

        .item-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            z-index: 20;
        }

        .item-actions .btn {
            padding: 4px 8px;
        }

        .item-actions .dropdown-menu {
            left: auto;
            right: 0;
            min-width: 140px;
        }

        /* Evita que el icono de opciones ‚Äúrobe‚Äù espacio visual */
        .item-actions .glyphicon {
            font-size: 14px;
        }
    </style>
</head>

<body>

<!-- ================= NAVBAR ================= -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">

        <!-- Header -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse"
                    data-target="#navbarMain">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a class="navbar-brand" href="/">MyGameCollection</a>
        </div>

        <!-- Form b√∫squeda -->
        <div class="navbar-form navbar-left">
            <form class="form-inline" th:action="@{/}">
                <div class="form-group">
                    <input type="text"
                           name="palabraClave"
                           class="form-control"
                           id="palabraClave"
                           th:value="${palabraClave}"
                           placeholder="titulo o parte de la observacion (sensible a mayusculas y minusculas)"
                           size="55">
                </div>
                <input type="submit" class="btn btn-primary" value="Buscar">
            </form>
        </div>

        <!-- Men√∫ principal -->
        <div id="navbarMain" class="collapse navbar-collapse">

            <!-- Opciones admin -->
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle"
                       data-toggle="dropdown">
                        Opciones <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a th:href="@{/admin/plataforma/}">Gesti√≥n de plataformas</a></li>
                        <li><a th:href="@{/admin/titulo/}">Gesti√≥n de t√≠tulos</a></li>
                        <li><a th:href="@{/admin/genero/}">Gesti√≥n de g√©neros</a></li>
                        <li><a th:href="@{/admin/region/}">Gesti√≥n de regiones</a></li>
                        <li><a th:href="@{/admin/importar-exportar}">Importar / Exportar</a></li>
                    </ul>
                </li>
            </ul>

            <!-- üî• PLATAFORMAS SOLO EN M√ìVIL -->
            <ul class="nav navbar-nav visible-xs">
                <li class="dropdown-header">Plataformas</li>
                <li th:each="plataforma : ${plataformas}">
                    <a class="mobile-platform-link"
                       th:href="@{/(idPlataforma=${plataforma.id})}"
                       th:text="${plataforma.nombre}">
                    </a>
                </li>
            </ul>

        </div>
    </div>
</nav>

<!-- ================= CONTENIDO ================= -->
<div class="container-fluid">
    <div class="row">

        <!-- SIDEBAR PLATAFORMAS (SOLO ESCRITORIO) -->
        <div class="col-sm-3 col-md-2 sidebar hidden-xs">

            <!-- üî• CABECERA CON BOT√ìN + -->
            <div style="display:flex; align-items:center; justify-content:space-between;">
                <h3 style="margin:0;">Plataformas</h3>

                <a th:href="@{/admin/plataforma/nueva}"
                   class="btn btn-xs btn-primary"
                   title="A√±adir plataforma">
                    <span class="glyphicon glyphicon-plus"></span>
                </a>
            </div>

            <hr style="margin:10px 0;">

            <ul class="nav nav-sidebar">
                <li th:each="plataforma : ${plataformas}">
                    <a th:href="@{/(idPlataforma=${plataforma.id})}"
                       th:text="${plataforma.nombre}">
                    </a>
                </li>
            </ul>
        </div>

        <!-- CONTENIDO PRINCIPAL -->
        <div class="col-xs-12 col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">

            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:20px;">
                <h1 style="margin:0;">Algunos T√≠tulos</h1>

                <a th:href="@{/admin/titulo/nuevo}"
                   class="btn btn-primary"
                   title="A√±adir nuevo t√≠tulo">
                    <span class="glyphicon glyphicon-plus"></span> Nuevo t√≠tulo
                </a>
                <a th:href="@{/admin/genero/nueva}"
                   class="btn btn-primary"
                   title="A√±adir nuevo genero">
                    <span class="glyphicon glyphicon-plus"></span> Nuevo genero
                </a>
                <a th:href="@{/admin/region/nueva}"
                   class="btn btn-primary"
                   title="A√±adir nueva region">
                    <span class="glyphicon glyphicon-plus"></span> Nueva region
                </a>
            </div>


            <div class="row">

                <!-- GRID RESPONSIVE -->
                <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"
                     th:each="titulo : ${titulos}">

                    <div class="col-item">

                        <!-- üî• BOT√ìN 3 PUNTOS -->
                        <div class="item-actions dropdown">
                            <button type="button"
                                    class="btn btn-default btn-xs dropdown-toggle"
                                    data-toggle="dropdown"
                                    aria-haspopup="true"
                                    aria-expanded="false"
                                    title="Opciones">
                                <span class="glyphicon glyphicon-option-vertical"></span>
                            </button>

                            <ul class="dropdown-menu">
                                <li>
                                    <a th:href="@{/admin/titulo/editar/{id}(id=${titulo.id})}">
                                        <span class="glyphicon glyphicon-pencil"></span> Editar
                                    </a>
                                </li>
                                <li role="separator" class="divider"></li>
                                <li>
                                    <a href="#"
                                       data-toggle="modal"
                                       data-target="#delete-modal"
                                       th:attr="data-id=${titulo.id},data-nombre=${titulo.nombre}">
                                        <span class="glyphicon glyphicon-trash"></span> Eliminar
                                    </a>
                                </li>
                            </ul>
                        </div>

                        <!-- Link al detalle (solo el contenido, no toda la caja, para no interferir con el dropdown) -->
                        <a th:href="@{/titulo/{id}(id=${titulo.id})}"
                           style="text-decoration:none; color:inherit;">

                            <div class="photo">
                                <img class="img-responsive"
                                     th:src="${#strings.isEmpty(titulo.imagen)}
                                              ? '/img/notfound.png'
                                              : '/img/games/' + ${titulo.imagen}"
                                     alt="Imagen del juego">
                            </div>

                            <div class="info">
                                <h4 class="product-name"
                                    th:text="${titulo.nombre}">
                                    Nombre del juego
                                </h4>
                            </div>

                        </a>

                    </div>

                </div>

            </div>

        </div>
    </div>
</div>

<!-- ================= MODAL BORRAR ================= -->
<div class="modal fade" id="delete-modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
                <h4 class="modal-title">Eliminar t√≠tulo</h4>
            </div>

            <div class="modal-body">
                <p>
                    ¬øEst√°s seguro de eliminar el t√≠tulo
                    <strong id="titulo-nombre"></strong>?
                </p>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">
                    Cancelar
                </button>
                <a href="#"
                   class="btn btn-danger"
                   id="confirmDeleteTitulo">
                    Eliminar
                </a>
            </div>

        </div>
    </div>
</div>

<!-- ================= JS ================= -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script>
    // Cerrar men√∫ hamburguesa al pulsar plataforma en m√≥vil
    $(document).on('click', '.mobile-platform-link', function () {
        $('#navbarMain').collapse('hide');
    });

    // Modal borrar: rellena nombre y URL
    $('#delete-modal').on('show.bs.modal', function (event) {
        var link = $(event.relatedTarget);
        var id = link.data('id');
        var nombre = link.data('nombre');

        $('#titulo-nombre').text(nombre);
        $('#confirmDeleteTitulo').attr('href', '/admin/titulo/borrar/' + id);
    });
</script>

</body>
</html>
